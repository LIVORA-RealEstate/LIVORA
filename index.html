<!doctype html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>LIVORA — ليفورا</title>

  <!-- منع الكاش أثناء التطوير -->
  <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate" />
  <meta http-equiv="Pragma" content="no-cache" />
  <meta http-equiv="Expires" content="0" />

  <!-- SEO مبسّط -->
  <meta name="description" content="LIVORA — منصة عقارية موثوقة لعرض وبيع وشراء العقارات محليًا وخليجيًا. تواصل واتساب فوري وفلترة مرنة ودعم عملات متعددة." />
  <meta property="og:title" content="LIVORA — المنصّة العقارية" />
  <meta property="og:description" content="شبكة مستثمرين، وتواصل مباشر عبر واتساب، ودعم عملات متعددة." />
  <meta property="og:type" content="website" />

  <!-- Google Analytics GA4 -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=G-2WXJ9SL5LP"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){ dataLayer.push(arguments); }
    gtag('js', new Date());
    gtag('config', 'G-2WXJ9SL5LP');
  </script>

  <!-- Tailwind + React UMD + Babel -->
  <script src="https://cdn.tailwindcss.com"></script>
  <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
  <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

  <style>
    :root { --font-ar: system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial, "Noto Sans Arabic", "Noto Sans", "Apple Color Emoji", "Segoe UI Emoji"; }
    html, body { height: 100%; }
    body { font-family: var(--font-ar); background: #fafafa; }
    .container { max-width: 1120px; }
    .glass { backdrop-filter: blur(6px); background: rgba(255,255,255,.7); }
  </style>
</head>
<body>
  <div id="root"></div>

  <script type="text/babel">
    const { useEffect, useMemo, useState } = React;

    /* إعدادات البراند */
    const BRAND = {
      nameEn: "LIVORA Estate",
      nameAr: "ليفورا",
      phoneIntl: "+962796353701",
      whatsapp: "https://wa.me/962796353701",
      email: "livoraestate.global@gmail.com",
      primary: "bg-black",
    };

    /* رابط Google Sheet CSV (عام) */
    const CSV_URL = "https://docs.google.com/spreadsheets/d/e/2PACX-1vTqmT5i7QVxFy-laVQN9K2R-Xgz-rNorv0CXS-a9dZd1DF8SMM3JF3ElzTNvV1oXoHKazCL0vRj5sVr/pub?gid=0&single=true&output=csv";

    /* أسعار صرف بسيطة افتراضية - عدّلها لاحقًا أو وصل API */
    const DEFAULT_RATES = {
      JOD: 1,       // دينار أردني أساس
      USD: 1.41,    // مثال
      AED: 5.18,
      SAR: 5.28,
      EUR: 1.29
    };

    /* أدوات */
    const currencyLabel = { JOD:"دينار", USD:"دولار", AED:"درهم", SAR:"ريال", EUR:"يورو" };
    function toNumber(x){
      if(x === null || x === undefined) return 0;
      const s = String(x).replace(/[^0-9.\-]/g,'');
      const n = parseFloat(s);
      return isNaN(n) ? 0 : n;
    }
    function priceFmt(v, c, rates){
      const jod = toNumber(v);
      const r = rates[c] || 1;
      const converted = c === "JOD" ? jod : (jod / rates["JOD"]) * r;
      const withSep = Math.round(converted).toLocaleString();
      const unit = currencyLabel[c] || c;
      return `${withSep} ${unit}`;
    }

    /* CSV Parser بسيط (يكفي Google Sheet CSV) */
    function parseCSV(text){
      const lines = text.trim().split(/\r?\n/);
      if(!lines.length) return [];
      const headers = lines[0].split(",").map(h => h.trim());
      const rows = [];
      for(let i=1;i<lines.length;i++){
        // دعم الحقول بين ""
        const row = [];
        let cur = "", inQ = false;
        const line = lines[i];
        for(let j=0;j<line.length;j++){
          const ch = line[j];
          if(ch === '"' ){
            if(inQ && line[j+1] === '"'){ cur += '"'; j++; }
            else inQ = !inQ;
          }else if(ch === ',' && !inQ){
            row.push(cur); cur="";
          }else{
            cur += ch;
          }
        }
        row.push(cur);
        const obj = {};
        headers.forEach((h,idx)=> obj[h] = (row[idx]||"").trim());
        rows.push(obj);
      }
      return rows;
    }

    /* بطاقة عقار */
    function ListingCard({ item, currency, rates }){
      const price = priceFmt(item.priceJOD, currency, rates);
      const waText = encodeURIComponent(
        `استفسار عن عقار:
العنوان: ${item.title}
المدينة: ${item.city||""}
السعر (${currency}): ${price}
رابط الصورة: ${item.img||""}`
      );
      const wa = `${BRAND.whatsapp}?text=${waText}`;
      return (
        <article className="rounded-3xl overflow-hidden border bg-white shadow hover:shadow-md transition">
          <div className="relative">
            {!!item.img && <img src={item.img} alt={item.title} className="h-48 w-full object-cover" loading="lazy" />}
            {item.is_featured?.toString().toLowerCase()==="true" && (
              <div className="absolute top-3 right-3 px-3 py-1 rounded-full text-xs bg-yellow-300 border">مميز</div>
            )}
          </div>
          <div className="p-4">
            <div className="text-sm text-neutral-500">{item.tag || item.type || ""}</div>
            <div className="mt-1 font-extrabold">{item.title}</div>
            <div className="text-sm text-neutral-600 mt-1">{item.city || ""}</div>
            {item.meta && <div className="text-xs text-neutral-600 mt-2">{item.meta}</div>}
            <div className="mt-3 font-extrabold">{price}</div>
            <div className="mt-4 grid grid-cols-2 gap-2">
              <a href={wa} target="_blank" className="text-center px-4 py-2 rounded-xl bg-black text-white text-sm">واتساب</a>
              <a href={`mailto:${BRAND.email}?subject=استفسار عقار: ${encodeURIComponent(item.title)}`} className="text-center px-4 py-2 rounded-xl border text-sm">إيميل</a>
            </div>
          </div>
        </article>
      );
    }

    /* التطبيق */
    function App(){
      const [currency, setCurrency] = useState("JOD");
      const [rates, setRates] = useState(DEFAULT_RATES);
      const [rows, setRows] = useState([]);
      const [loading, setLoading] = useState(true);
      const [err, setErr] = useState("");

      useEffect(()=>{
        async function load(){
          try{
            setLoading(true);
            const res = await fetch(CSV_URL, { cache: "no-store" });
            if(!res.ok) throw new Error("تعذر جلب البيانات");
            const text = await res.text();
            const data = parseCSV(text)
              .filter(r => (r.approved||"").toString().toLowerCase()==="true");
            setRows(data);
          }catch(e){
            setErr(e.message || "خطأ غير متوقع");
          }finally{
            setLoading(false);
          }
        }
        load();
      },[]);

      const featured = useMemo(()=> rows.filter(r => (r.is_featured||"").toString().toLowerCase()==="true"), [rows]);
      const normal = useMemo(()=> rows.filter(r => (r.is_featured||"").toString().toLowerCase()!=="true"), [rows]);

      return (
        <div className="min-h-screen">
          <header className="w-full border-b bg-white/90 backdrop-blur sticky top-0 z-50">
            <div className="container mx-auto px-4 py-3 flex items-center justify-between">
              <div className="flex items-center gap-3">
                <div className="h-10 w-10 rounded-2xl bg-black text-white grid place-items-center font-bold">L</div>
                <div className="font-extrabold text-xl">{BRAND.nameEn} | {BRAND.nameAr}</div>
              </div>
              <div className="flex items-center gap-3">
                <select value={currency} onChange={e=>setCurrency(e.target.value)} className="px-3 py-2 rounded-xl border text-sm">
                  {Object.keys(DEFAULT_RATES).map(k => <option key={k} value={k}>{k} — {currencyLabel[k]}</option>)}
                </select>
                <a href={BRAND.whatsapp} target="_blank" className="px-4 py-2 rounded-2xl bg-black text-white text-sm">واتساب فوري</a>
              </div>
            </div>
          </header>

          <section className="relative">
            <div className="absolute inset-0 -z-10 bg-gradient-to-b from-neutral-100 to-neutral-50"></div>
            <div className="container mx-auto px-4 pt-12 pb-10 grid lg:grid-cols-2 gap-8 items-center">
              <div>
                <h1 className="text-3xl md:text-5xl font-extrabold leading-tight">
                  منصة عقارية موثوقة لصفقات <span className="bg-yellow-200 px-2 rounded">الأراضي، الشقق، المجمعات، والمدارس</span>
                </h1>
                <p className="mt-4 text-neutral-700">
                  نُحوّل الجدية إلى صفقات: تحقق ملكية صارم، توثيق رسمي، تسويق احترافي، شبكة مستثمرين محلية وخليجية — مع أدوات فورية تزيد احتمالية الإغلاق.
                </p>
                <div className="mt-6 flex flex-wrap items-center gap-3 text-sm text-neutral-700">
                  <div className="px-3 py-1.5 rounded-full bg-white border">اتفاقيات موثقة</div>
                  <div className="px-3 py-1.5 rounded-full bg-white border">تحقق ملكية</div>
                  <div className="px-3 py-1.5 rounded-full bg-white border">وساطة عادلة</div>
                  <div className="px-3 py-1.5 rounded-full bg-white border">شبكة خليجية</div>
                </div>
              </div>
              <div className="relative">
                <img src="https://images.unsplash.com/photo-1501183638710-841dd1904471?q=80&w=1200&auto=format&fit=crop" alt="Hero" className="rounded-3xl shadow-xl w-full h-[360px] object-cover"/>
                <div className="absolute -bottom-5 left-5 right-5 bg-white rounded-2xl shadow p-4 flex items-center gap-4">
                  <div className="hidden md:block h-12 w-12 rounded-xl bg-neutral-900 text-white grid place-items-center font-bold">✔</div>
                  <div>
                    <div className="font-bold">سياسة التحقق قبل النشر</div>
                    <div className="text-sm text-neutral-600">لا يُنشر أي عقار دون وثائق وصور واقعية وموقع دقيق.</div>
                  </div>
                </div>
              </div>
            </div>
          </section>

          <main className="container mx-auto px-4">
            {/* قسم العقارات المميّزة إن وُجد */}
            {featured.length > 0 && (
              <section className="mb-10">
                <div className="flex items-end justify-between mb-4">
                  <h2 className="text-2xl md:text-3xl font-extrabold">عقارات مميّزة</h2>
                </div>
                <div className="grid sm:grid-cols-2 lg:grid-cols-3 gap-5">
                  {featured.map((l,i)=> <ListingCard key={`f-${i}`} item={l} currency={currency} rates={rates} />)}
                </div>
              </section>
            )}

            {/* بقية العقارات */}
            <section className="mb-16">
              <div className="flex items-end justify-between mb-4">
                <h2 className="text-2xl md:text-3xl font-extrabold">كل العقارات</h2>
              </div>

              {loading && (
                <div className="rounded-2xl border bg-white p-6 text-neutral-600">جارٍ تحميل البيانات…</div>
              )}

              {!loading && err && (
                <div className="rounded-2xl border bg-red-50 p-6 text-red-700">خطأ في جلب البيانات: {err}</div>
              )}

              {!loading && !err && rows.length === 0 && (
                <div className="rounded-2xl border bg-white p-6 text-neutral-600">
                  لا توجد عقارات بعد. أضِف صفوفًا إلى Google Sheet مع <b>approved = TRUE</b> وستظهر هنا مباشرة.
                </div>
              )}

              <div className="grid sm:grid-cols-2 lg:grid-cols-3 gap-5">
                {normal.map((l,i)=> <ListingCard key={`n-${i}`} item={l} currency={currency} rates={rates} />)}
              </div>
            </section>
          </main>

          <section id="contact" className="container mx-auto px-4 mb-20">
            <div className="grid lg:grid-cols-2 gap-6">
              <div className="rounded-3xl border bg-white p-6 md:p-10 shadow-sm">
                <h3 className="text-2xl font-extrabold">تواصل سريع</h3>
                <p className="text-neutral-600 mt-2">اختر الطريقة الأسهل لك للتواصل المباشر.</p>
                <div className="mt-6 grid gap-3">
                  <a href={BRAND.whatsapp} target="_blank" className="px-5 py-3 rounded-2xl bg-black text-white font-semibold text-center">واتساب فوري</a>
                  <a href={`mailto:${BRAND.email}`} className="px-5 py-3 rounded-2xl border font-semibold text-center">مراسلة بريدية</a>
                </div>
                <div className="text-xs text-neutral-500 mt-3">
                  عند الإرسال أنت توافق على سياسة الخصوصية والشروط.
                </div>
              </div>
              <div className="rounded-3xl border bg-white p-6 md:p-10 shadow-sm">
                <h3 className="text-2xl font-extrabold">معلومات الاتصال</h3>
                <div className="mt-4 text-neutral-700 leading-8 text-sm">
                  <div><b>الهاتف/واتساب:</b> {BRAND.phoneIntl}</div>
                  <div><b>البريد:</b> {BRAND.email}</div>
                </div>
              </div>
            </div>
          </section>

          <footer className="border-t bg-white">
            <div className="container mx-auto px-4 py-8 text-sm flex flex-col md:flex-row items-center md:items-start justify-between gap-4">
              <div className="text-neutral-600">© {new Date().getFullYear()} {BRAND.nameEn} – جميع الحقوق محفوظة.</div>
              <div className="flex gap-4 text-neutral-600">
                <a href="#" className="hover:opacity-70">الشروط والأحكام</a>
                <a href="#" className="hover:opacity-70">سياسة الخصوصية</a>
                <a href={BRAND.whatsapp} target="_blank" className="hover:opacity-70">واتساب</a>
              </div>
            </div>
          </footer>
        </div>
      );
    }

    ReactDOM.createRoot(document.getElementById('root')).render(<App />);
  </script>
</body>
</html>
